var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,o=(a,t,n)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n;import{w as s,ar as l,M as i,e as r,y as c,u as d,as as m,r as p,at as u}from"./index.886dfe0f.js";import{I as g}from"./index.ea47fda8.js";import{g as f,T as v,a as y,P as h}from"./usePagination.3f5c0e2c.js";import"./index.83b32b72.js";import{l as b,m as x,r as C,n as R}from"./api.b5828984.js";import{e as I,a as w,H as S,d as z,r as k,o as T,c as j,g as N,B as P,N as O,D as M,P as _}from"./vendor.85ba868e.js";const A=[{title:"No.",dataIndex:"id",slots:{customRender:"id"}},{title:"Article Title",dataIndex:"title"},{title:"Comment Content",dataIndex:"content",width:"30%"},{title:"From",dataIndex:"from"},{title:"To",dataIndex:"to"},{title:"Comment Time",dataIndex:"createTime",slots:{customRender:"createTime"}},{title:"Action",dataIndex:"action",slots:{customRender:"action"}}];var U=z({name:"index",components:{"a-table":v,"a-tag":y,"a-badge":m,"pop-confirm":h,"a-modal":p,"a-input":g,"a-textarea":g.TextArea},setup:()=>((e,s)=>{for(var l in s||(s={}))a.call(s,l)&&o(e,l,s[l]);if(t)for(var l of t(s))n.call(s,l)&&o(e,l,s[l]);return e})({},function(){const e=I(!1),a=f(),t=I([]),n=I([]),o=w((()=>n.value.length>0)),m=I(!1),p=I({}),u=I(""),g=d();function v(n){e.value=!0,h(),b(n).then((n=>{if(e.value=!1,!n.success)return void s(n.message);const{list:o,total:r,unread:c}=n.data;t.value=l(o),a.total=r,g.commit(i,c)})).catch((a=>{e.value=!1,r(a.message)}))}const y={onChange:e=>{n.value=[...e]},getCheckboxProps:e=>({disabled:1===e.isRead})},h=()=>{n.value=[]},z=e=>{m.value=e,!e&&!u.value.trim()&&(u.value="")};return S((()=>{v({pageNo:a.current,pageSize:a.pageSize})})),{loading:e,columns:A,pagination:a,commentList:t,canBeRead:o,replyVisible:m,selectedRowKeys:n,rowSelection:y,replyTargetInfo:p,replyContent:u,handlePageChange:function(e){const t=e.current,n=e.pageSize;a.current=t,a.pageSize=n,v({pageNo:t,pageSize:n})},handleDeleteComments:function(e){const{id:t,parentId:n}=e;x({id:t,parentId:n}).then((e=>{e.success?(c(e.message),v({pageNo:a.current,pageSize:a.pageSize})):s(e.message)})).catch((e=>{r(e.message)}))},openReply:function(e){p.value=e,z(!0)},reply:()=>{const{id:e,topicId:t,parentId:n,fromName:o,fromEmail:l,isRead:i,title:d,articleId:m,articleUid:g}=p.value;R({id:e,topicId:t,isRead:i,articleId:m,articleUid:g,parentId:null!==n?n:e,toName:o,toEmail:l,comment:u.value.trim(),articleTitle:d}).then((e=>{e.success?(z(!1),c(e.message),v({pageNo:a.current,pageSize:a.pageSize})):s(e.message)})).catch((e=>{r(e.message)}))},showReplyModal:z,handleRead:function(){C({ids:[...n.value]}).then((e=>{e.success?(c(e.message),v({pageNo:a.current,pageSize:a.pageSize})):s(e.message)})).catch((e=>{r(e.message)}))}}}())});const B={class:"comment"},D={class:"primary-title flex-between"},E=N("span",null,[N("i",{class:"iconfont icon-flashing"}),O(" Comment Management ")],-1),V=N("i",{class:"iconfont icon-update"},null,-1),L={class:"action"},F=N("i",{class:"iconfont icon-delete"},null,-1),H={class:"modal-avatar"},K=N("img",{src:u,alt:"avatar"},null,-1),q={class:"mentions-txt info"},G={class:"reply-content"};U.render=function(e,a,t,n,o,s){const l=k("a-badge"),i=k("a-tag"),r=k("pop-confirm"),c=k("a-table"),d=k("a-textarea"),m=k("a-modal");return T(),j("section",B,[N("h3",D,[E,N("span",{class:"link-txt d-flex",disabled:!e.canBeRead},[V,N("span",{onClick:a[1]||(a[1]=(...a)=>e.handleRead&&e.handleRead(...a))},"Mark As Read")],8,["disabled"])]),N(c,{loading:e.loading,columns:e.columns,"row-key":e=>e.id,pagination:e.pagination,"data-source":e.commentList,"row-selection":e.rowSelection,onChange:e.handlePageChange},{id:P((({record:e,index:a})=>[N(l,{dot:0===e.isRead},{default:P((()=>[O(M(a+1),1)])),_:2},1032,["dot"])])),createTime:P((({text:e})=>[N(i,{color:"cyan"},{default:P((()=>[O(M(e),1)])),_:2},1024)])),action:P((({record:t})=>[N("span",L,[N("i",{class:"iconfont icon-reply",onClick:_((a=>e.openReply(t)),["stop"])},null,8,["onClick"]),N(r,{onClick:a[2]||(a[2]=_((()=>{}),["stop"])),title:"Sure to delete ?",onConfirm:_((a=>e.handleDeleteComments(t)),["stop"])},{default:P((()=>[F])),_:2},1032,["onConfirm"])])])),_:1},8,["loading","columns","row-key","pagination","data-source","row-selection","onChange"]),N(m,{visible:e.replyVisible,"onUpdate:visible":a[4]||(a[4]=a=>e.replyVisible=a),class:"reply-modal",centered:"",onOk:e.reply,onCancel:a[5]||(a[5]=a=>e.showReplyModal(!1))},{default:P((()=>[N("div",H,[K,N("span",q,"回复："+M(e.replyTargetInfo.fromName),1)]),N("div",G,[N(d,{placeholder:"评论回复...",value:e.replyContent,"onUpdate:value":a[3]||(a[3]=a=>e.replyContent=a),autoSize:{minRows:8,maxRows:8}},null,8,["value"])])])),_:1},8,["visible","onOk"])])};export default U;
