<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack loaders & plugins | K.island ✨</title>
    <meta name="description" content="K.'s island">
    <link rel="stylesheet" href="/assets/style.019f39fc.css">
    <link rel="modulepreload" href="/assets/Home.7f051d33.js">
    <link rel="modulepreload" href="/assets/app.108cc30f.js">
    <link rel="modulepreload" href="/assets/knowledge_engineering_loaderAndPlugin.md.74511eee.lean.js">
    <link rel="modulepreload" href="/assets/app.108cc30f.js">
    <link rel="icon" href="/favicon.ico" sizes="64x64">
    <link rel="apple-touch-icon-precomposed" href="/favicon.ico" sizes="64x64">
    <link rel="msapplication-square64x64logo" href="/favicon.ico" sizes="64x64">
    <meta name="twitter:title" content="webpack loaders &amp; plugins | K.island ✨">
    <meta property="og:title" content="webpack loaders &amp; plugins | K.island ✨">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="K.island ✨, back to home" data-v-675d8756 data-v-4a583abe><!----> K.island ✨</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Home <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/mood/index" data-v-b8818f8c>Mood <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/knowledge/index" data-v-b8818f8c>Knowledge <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/interview/index" data-v-b8818f8c>Interview <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/algorithm/index" data-v-b8818f8c>Algorithm <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/suressk" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Home <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/mood/index" data-v-b8818f8c>Mood <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/knowledge/index" data-v-b8818f8c>Knowledge <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/interview/index" data-v-b8818f8c>Interview <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/algorithm/index" data-v-b8818f8c>Algorithm <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/suressk" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">Introduction</p><!----></li><li class="sidebar-link"><p class="sidebar-link-item">Study Note</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/jsEventLoop">JS EventLoop</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/promise">Promise</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/vueNextTick">Vue NextTick</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/algorithm">Algorithm</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Vite</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/index">Vite 原理简介</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/vitejs">从 vite 到 createServer</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/resolveConfig">resolveConfig</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/esbuild">依赖预构建</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/plugin">插件机制</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">React</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/react/index">React 笔记文章 - 掘金</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/react/fiber">React Fiber</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Engineering</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/webpack">webpack</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/knowledge/engineering/loaderAndPlugin">webpack Loader &amp; plugin</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#loaders">Loaders</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#loader-特性">loader 特性</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#常见-loader">常见 loader</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#plugins">Plugins</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#特性">特性</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#常见-plugin">常见 plugin</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#二者的区别">二者的区别</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#编写-loader">编写 Loader</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#编写-plugin">编写 Plugin</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/tapable">webpack Tapable</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/hotUpdate">webpack 热更新</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/compare">打包工具对比</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/lint">代码规范</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><p><code>webpack</code> 做的事情，仅仅是分析出各种模块的依赖关系，然后形成资源列表，最终打包📦 生成到指定的文件中</p><h2 id="loaders" tabindex="-1">Loaders <a class="header-anchor" href="#loaders" aria-hidden="true">#</a></h2><p><code>loader</code> 则是用于对模块的 <code>源代码</code> 进行转换，在 <code>import</code> 或 <code>require</code> 模块（加载模块）时预处理文件</p><p>在 <code>webpack</code> 中，任何文件都是模块，默认情况下，在遇到 <code>import</code> 或者 <code>require</code> 加载模块的时候，<code>webpack</code> 只支持对 <code>js</code> 和 <code>json</code> 文件打包；像 <code>css</code>、<code>sass</code>、<code>png</code> 等这些类型的文件，<code>webpack</code> 则无能为力，这时候就需要配置对应的 <code>loader</code> 进行文件内容的解析</p><p>在加载模块的时候，执行顺序为： <code>入口 entry</code> ➡️ <code>loaders</code> ➡️ <code>output 输出</code></p><p>当 <code>webpack</code> 碰到无法识别的模块时，则去配置的 <code>loaders</code> 中查找该文件的解析规则（一般推荐配置在 <code>webpack.config.js</code> 中）</p><div class="language-js"><pre><code><span class="token comment">// webpack.config.js 示例配置</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">&#39;./src/main.ts&#39;</span><span class="token punctuation">,</span>
    <span class="token comment">// ... 其他配置</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(css|scss)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token comment">/* 创建 &lt;style&gt; 标签插入 html */</span>
                    <span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span>
                    <span class="token comment">/* 识别解析 css 语法 ⬆️ */</span>
                    <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span>
                    <span class="token comment">/* 识别解析 sass 语法 ⬆️ */</span>
                    <span class="token string">&#39;sass-loader&#39;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="loader-特性" tabindex="-1">loader 特性 <a class="header-anchor" href="#loader-特性" aria-hidden="true">#</a></h3><ul><li><p><code>loader</code> 支持 <strong>链式调用</strong></p><blockquote><p>链中的每个 <code>loader</code> 会处理之前已处理过的资源，最终变为 <code>js代码</code>。顺序为 <strong>相反</strong> 的顺序执行，即上述执行顺序为 <code>sass-loader</code>、<code>css-loader</code>、<code>style-loader</code></p></blockquote></li><li><p><code>loader</code> 可以是同步的，也可以是异步的</p></li><li><p><code>loader</code> 运行在 <code>Node</code> 环境中，并且能够执行任何操作（比如读取文件，输出文件等）</p></li><li><p>插件（<code>plugin</code>）可以进一步增强 <code>loader</code> 的功能</p></li><li><p><code>loader</code> 能够产生额外的任意文件</p></li></ul><p>使用 loader 可以将各功能模块进行更细粒度的拆分</p><h3 id="常见-loader" tabindex="-1">常见 loader <a class="header-anchor" href="#常见-loader" aria-hidden="true">#</a></h3><ul><li><code>style-loader</code>：将 <code>css</code> 添加到 <code>DOM</code> 的内联样式标签 <code>&lt;style&gt;</code> 里</li><li><code>css-loader</code> :允许将 <code>css</code> 文件通过require的方式引入，并返回css代码</li><li><code>less-loader</code>：处理 <code>less</code></li><li><code>sass-loader</code>：处理 <code>sass</code></li><li><code>postcss-loader</code>：用 <code>postcss</code> 来处理 <code>css</code> （如：添加浏览器兼容类名前缀 <code>-webkit-</code>）</li><li><code>file-loader</code>：分发文件到 <code>output</code> 目录并返回相对路径</li><li><code>url-loader</code>：和 <code>file-loader</code> 类似，但是当文件小于设定的 <code>limit</code> 时可以返回一个 <code>Data Url</code></li><li><code>html-minify-loader</code>：压缩 <code>HTML</code></li><li><code>babel-loader</code>：用 <code>babel</code> 来转换 <code>ES6</code> 文件到 <code>ES5</code></li></ul><h2 id="plugins" tabindex="-1">Plugins <a class="header-anchor" href="#plugins" aria-hidden="true">#</a></h2><p><code>plugin</code> 释义：</p><blockquote><p>是一种计算机应用程序，它和主应用程序（<code>host application</code>）互相交互，以提供特定的功能</p></blockquote><p><code>webpack</code> 中的 <code>plugin</code> 是遵循一定规范编写出来的程序，为 <code>webpack</code> 赋予灵活的功能，如：打包优化、资源管理、环境变量注入等，它们会运行在 <code>webpack</code> 的不同阶段（<code>钩子</code> / <code>生命周期</code>），贯穿了 <strong><code>webpack</code> 整个编译周期</strong></p><blockquote><p>它们与 <code>loader</code> 不同，<code>loader</code> 是串行运行的，只在某个阶段运行，<code>plugin</code> 则是贯穿编译的整个周期，旨在解决 <code>loader</code> 无法解决的问题</p></blockquote><div class="language-js"><pre><code><span class="token comment">// webpack.config.js 示例配置</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;html-webpack-plugin&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">&#39;./src/main.ts&#39;</span><span class="token punctuation">,</span>
    <span class="token comment">// ... 其他配置</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> template<span class="token operator">:</span> <span class="token string">&#39;./public/index.html&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="特性" tabindex="-1">特性 <a class="header-anchor" href="#特性" aria-hidden="true">#</a></h3><p>本质上它是一个具有 <code>apply</code> 方法的 <code>javascript</code> （类）对象；<code>apply</code> 方法会被 <code>webpack compiler</code> 调用，并且在整个编译生命周期都可以访问 <code>compiler</code> 对象</p><div class="language-js"><pre><code><span class="token comment">// 示例</span>
<span class="token keyword">class</span> <span class="token class-name">HtmlWebpackPlugin</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userOptions <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>version <span class="token operator">=</span> HtmlWebpackPlugin<span class="token punctuation">.</span>version<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>initialize<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;HtmlWebpackPlugin&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> userOptions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userOptions<span class="token punctuation">;</span>
            <span class="token keyword">const</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* ... default options */</span> <span class="token punctuation">}</span>
            <span class="token keyword">const</span> options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>defaultOptions<span class="token punctuation">,</span> userOptions<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HtmlWebpackPlugin<span class="token punctuation">;</span>
</code></pre></div><p>从上面的示例代码，我们可以知道，<code>compiler.hooks</code> <code>tap</code> 方法的第一个参数就是插件名称（大驼峰命名）</p><p>钩子函数类型来自<a href="https://github.com/webpack/tapable#tapable" target="_blank" rel="noopener noreferrer">Tapable 🔗</a>，暴露的钩子函数有<a href="https://webpack.docschina.org/api/compiler-hooks/" target="_blank" rel="noopener noreferrer">webpack plugin hooks 🔗</a>，比如：</p><ul><li><p><code>entryOption</code>：[<code>SyncBailHook</code>] 初始化 <code>option</code>，在 <code>webpack</code> 选项中的 <code>entry</code> 被处理过之后调用（回调参数：<code>context</code>, <code>entry</code>）</p><div class="language-js"><pre><code>compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>entryOption<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;MyPlugin&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> entry</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p><code>run</code>：[<code>AsyncSeriesHook</code>] 在开始读取 <code>records</code> 之前调用</p></li><li><p><code>compile</code>：[<code>SyncHook</code>] <code>beforeCompile</code> 之后立即调用，但在一个新的 <code>compilation</code> 创建之前。这个钩子 <strong>不会</strong> 被复制到子编译器</p></li><li><p><code>compilation</code>：[<code>SyncHook</code>] <code>compilation</code> 创建之后执行（回调参数：<code>compilation</code>, <code>compilationParams</code>）</p></li><li><p><code>make</code>：[<code>AsyncParallelHook</code>] <code>compilation</code> 结束之前执行。这个钩子 <strong>不会</strong> 被复制到子编译器（回调参数：<code>compilation</code>）</p></li><li><p><code>afterCompile</code>：[<code>AsyncSeriesHook</code>] 编译 <code>build</code> 过程结束，<code>compilation</code> 结束和封印之后执行（回调参数：<code>compilation</code>）</p></li><li><p><code>emit</code>：[<code>AsyncSeriesHook</code>] 输出 <code>asset</code> 到 <code>output</code> 目录之前执行。这个钩子 <strong>不会</strong> 被复制到子编译器</p></li><li><p><code>afterEmit</code>：[<code>AsyncSeriesHook</code>] 输出 <code>asset</code> 到 <code>output</code> 目录之后执行。这个钩子 <strong>不会</strong> 被复制到子编译器</p></li><li><p><code>done</code>：[<code>AsyncSeriesHook</code>] 在 <code>compilation</code> 完成时执行。这个钩子 <strong>不会</strong> 被复制到子编译器</p></li><li><p><code>failed</code>：[<code>SyncHook</code>] 在 <code>compilation</code> 失败时执行（回调参数：<code>error</code>）</p></li></ul><h3 id="常见-plugin" tabindex="-1">常见 plugin <a class="header-anchor" href="#常见-plugin" aria-hidden="true">#</a></h3><ul><li><code>html-webpack-plugin</code>：在打包结束后，⾃动生成⼀个 <code>html</code> 文件，并把打包生成的 <code>js</code> 模块引⼊到该 <code>html</code> 中</li><li><code>clean-webpack-plugin</code>：删除（清理）构建目录（每次打包都清除上次打包生成的文件）</li><li><code>copy-webpack-plugin</code>：复制文件或目录到打包结果目录中</li></ul><h2 id="二者的区别" tabindex="-1">二者的区别 <a class="header-anchor" href="#二者的区别" aria-hidden="true">#</a></h2><blockquote><ul><li><code>loader</code> 是文件加载器，能够加载资源文件，并对这些文件进行一些处理，诸如编译、压缩等，最终一起打包到指定的文件中</li><li><code>plugin</code> 赋予了 <code>webpack</code> 各种灵活的功能，例如打包优化、资源管理、环境变量注入等，目的是解决 <code>loader</code> 无法实现的其他事</li></ul></blockquote><ul><li><p>在运行时机上：</p><blockquote><ul><li><code>loader</code> 运行在打包之前</li><li><code>plugins</code> 在整个编译周期都起作用</li></ul></blockquote></li><li><p>在功能扩展上：</p><blockquote><ul><li><code>webpack</code> 运行的生命周期中会广播出许多事件，<code>Plugin</code> 可以监听这些事件，在合适的时机通过 <code>webpack</code> 提供的 <code>API</code> 改变输出结果</li><li>对于 <code>loader</code>，实质是一个转换器，将 <code>A文件</code> 进行编译形成 <code>B文件</code>，操作的是 <strong>文件</strong>，比如将 <code>A.scss</code> 或 <code>A.less</code> 转变为 <code>B.css</code>，单纯的文件转换过程</li></ul></blockquote></li></ul><h2 id="编写-loader" tabindex="-1">编写 Loader <a class="header-anchor" href="#编写-loader" aria-hidden="true">#</a></h2><p><code>loader</code> 的本质：</p><blockquote><ul><li><code>loader</code> 的本质就是函数，函数中的 <code>this</code> 作为上下文会被 <code>webpack</code> 填充，因此我们 <strong>不能</strong> 将 <code>loader</code> 设为一个箭头函数<br></li><li>这个函数接受一个参数，为 <code>webpack</code> 传递给 <code>loader</code> 的 <strong>文件源内容</strong><br></li><li>函数中 <code>this</code> 是由 <code>webpack</code> 提供的对象，能够获取当前 <code>loader</code> 所需要的各种信息</li><li>函数中有异步操作或同步操作，异步操作通过 <code>this.callback</code> 返回，返回值要求为 <strong><code>String</code></strong> 或者 <strong><code>Buffer</code></strong></li></ul></blockquote><p>示例：</p><div class="language-js"><pre><code><span class="token comment">// 导出一个函数，source 为 webpack 传递给 loader 的文件源内容</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">doSomeThing2JsString</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 如果 loader 配置了 options 对象，那么this.query将指向 options</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>query<span class="token punctuation">;</span>
    
    <span class="token comment">// 可以用作解析其他模块路径的上下文</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;this.context&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* this.callback(
     *    // 当 loader 出错时向外抛出一个 error
     *    err: Error | null,
     *    // 经过 loader 编译后需要导出的内容
     *    content: string | Buffer,
     *    // 可选参数，返回 source-map（为方便调试生成的编译后内容的 source-map）
     *    sourceMap?: SourceMap,
     *    // 可选参数，返回 meta（官方表示：ignored by webpack, can be anything）
     *    meta?: any 
     * );
     */</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异步</span>
    <span class="token keyword">return</span> content<span class="token punctuation">;</span> <span class="token comment">// 同步</span>
<span class="token punctuation">}</span>
</code></pre></div><p>原则：在编写 <code>loader</code> 时，尽量保持功能单一，方便维护与查找问题</p><h2 id="编写-plugin" tabindex="-1">编写 Plugin <a class="header-anchor" href="#编写-plugin" aria-hidden="true">#</a></h2><blockquote><p>由于 <code>webpack</code> 基于发布订阅模式，在运行的生命周期中会广播出许多事件，插件通过监听这些事件，就可以在特定的阶段执行自己的插件任务</p></blockquote><p><code>webpack</code> 编译会创建两个核心对象：</p><ul><li><code>compiler</code>：包含了 <code>webpack</code> 环境的所有的配置信息，包括 <code>options</code>，<code>loader</code> 和 <code>plugin</code>，和 <code>webpack</code> 整个生命周期相关的钩子</li><li><code>compilation</code>：作为 <code>plugin</code> 内置事件回调函数的参数，包含了当前的模块资源、编译生成资源、变化的文件以及被跟踪依赖的状态信息。当检测到一个文件变化，一次新的 <code>Compilation</code> 将被创建</li></ul><p>编写 <code>plugin</code> 要遵循的规范：</p><ul><li>插件必须是一个函数或者是一个包含 <code>apply</code> 方法的对象（一般是 <code>class</code> 类），这样才能访问 <code>compiler</code> 实例</li><li>由于传给每个插件的 <code>compiler</code> 和 <code>compilation</code> 对象都是同一个引用，因此不建议修改</li><li>异步的事件需要在插件处理完任务时调用回调函数通知 <code>webpack</code> 进入下一个流程，不然会卡住</li></ul><p>示例：</p><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token punctuation">{</span>
    <span class="token comment">// webpack 会调用 MyPlugin 实例的 apply 方法给插件实例传入 compiler 对象</span>
    <span class="token function">apply</span> <span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 找到合适的事件钩子，实现自己的插件功能</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;MyPlugin&#39;</span><span class="token punctuation">,</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// compilation: 当前打包构建流程的上下文</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// do something...</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 <code>emit</code> 事件发生时，代表源文件的转换和组装已经完成，可以读取到最终将 <code>输出的资源</code>、<code>代码块</code>、<code>模块及其依赖</code>，并且可以修改输出资源的内容</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/suressk/edit/deploy/docs/knowledge/engineering/loaderAndPlugin.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Edit this page on GitHub <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>Last Updated:</span><span class="datetime" data-v-5797b537></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/knowledge/engineering/webpack" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>webpack</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/knowledge/engineering/tapable" data-v-38ede35f><span class="text" data-v-38ede35f>webpack Tapable</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"algorithm_index.md\":\"e9fd5986\",\"algorithm_summary_complexity.md\":\"d85a1d14\",\"algorithm_summary_merge.md\":\"dd2f7be3\",\"algorithm_summary_stack.md\":\"a6961cf4\",\"index.md\":\"4abf28d5\",\"interview_index.md\":\"989b976b\",\"interview_summary_actual.md\":\"69045102\",\"interview_summary_basis.md\":\"703d5afc\",\"interview_summary_index.md\":\"9e205d84\",\"interview_summary_internet.md\":\"57762282\",\"interview_summary_optimization.md\":\"47633787\",\"interview_summary_strands.md\":\"a0c1029c\",\"knowledge_engineering_compare.md\":\"01e6dbb7\",\"knowledge_engineering_hotupdate.md\":\"340c8f32\",\"knowledge_engineering_lint.md\":\"7e34550b\",\"knowledge_engineering_loaderandplugin.md\":\"74511eee\",\"knowledge_engineering_tapable.md\":\"78fcf899\",\"knowledge_engineering_webpack.md\":\"bb8ee6aa\",\"knowledge_index.md\":\"09a7956f\",\"knowledge_react_fiber.md\":\"74f1d84d\",\"knowledge_react_index.md\":\"6f6372f6\",\"knowledge_study_algorithm.md\":\"75ecada9\",\"knowledge_study_jseventloop.md\":\"ffe3345b\",\"knowledge_study_promise.md\":\"7c7b147d\",\"knowledge_study_vuenexttick.md\":\"244c1996\",\"knowledge_vite_esbuild.md\":\"032a4384\",\"knowledge_vite_index.md\":\"16222dcb\",\"knowledge_vite_plugin.md\":\"76b64563\",\"knowledge_vite_resolveconfig.md\":\"370aa044\",\"knowledge_vite_vitejs.md\":\"0956746a\",\"mood_autumn.md\":\"b5a1e6ae\",\"mood_chinaintheclassics.md\":\"d0e29f8c\",\"mood_dragonboatfestival.md\":\"a4adaa88\",\"mood_fate.md\":\"ffcecf90\",\"mood_feels.md\":\"014fbdd7\",\"mood_index.md\":\"952f61ba\",\"mood_loneliness.md\":\"b149e24a\",\"mood_spring.md\":\"813caf57\",\"mood_wind.md\":\"67b6a485\",\"mood_yearend.md\":\"0b07f5b7\"}")</script>
    <script type="module" async src="/assets/app.108cc30f.js"></script>
    
  </body>
</html>