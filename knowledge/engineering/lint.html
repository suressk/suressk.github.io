<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>代码规范 | K.island ✨</title>
    <meta name="description" content="K.'s island">
    <link rel="stylesheet" href="/assets/style.019f39fc.css">
    <link rel="modulepreload" href="/assets/Home.7f051d33.js">
    <link rel="modulepreload" href="/assets/app.108cc30f.js">
    <link rel="modulepreload" href="/assets/knowledge_engineering_lint.md.19fb12b1.lean.js">
    <link rel="modulepreload" href="/assets/app.108cc30f.js">
    <link rel="icon" href="/favicon.ico" sizes="64x64">
    <link rel="apple-touch-icon-precomposed" href="/favicon.ico" sizes="64x64">
    <link rel="msapplication-square64x64logo" href="/favicon.ico" sizes="64x64">
    <meta name="twitter:title" content="代码规范 | K.island ✨">
    <meta property="og:title" content="代码规范 | K.island ✨">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="K.island ✨, back to home" data-v-675d8756 data-v-4a583abe><!----> K.island ✨</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Home <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/mood/index" data-v-b8818f8c>Mood <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/knowledge/index" data-v-b8818f8c>Knowledge <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/interview/index" data-v-b8818f8c>Interview <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/algorithm/index" data-v-b8818f8c>Algorithm <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/suressk" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Home <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/mood/index" data-v-b8818f8c>Mood <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/knowledge/index" data-v-b8818f8c>Knowledge <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/interview/index" data-v-b8818f8c>Interview <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/algorithm/index" data-v-b8818f8c>Algorithm <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/suressk" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">Introduction</p><!----></li><li class="sidebar-link"><p class="sidebar-link-item">Study Note</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/jsEventLoop">JS EventLoop</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/promise">Promise</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/vueNextTick">Vue NextTick</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/algorithm">Algorithm</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Vite</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/index">Vite 原理简介</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/vitejs">从 vite 到 createServer</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/resolveConfig">resolveConfig</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/esbuild">依赖预构建</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/plugin">插件机制</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">React</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/react/index">React 笔记文章 - 掘金</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/react/fiber">React Fiber</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Engineering</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/webpack">webpack</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/loaderAndPlugin">webpack Loader &amp; plugin</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/tapable">webpack Tapable</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/hotUpdate">webpack 热更新</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/compare">打包工具对比</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/knowledge/engineering/lint">代码规范</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#lint">Lint</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#commit-规范">Commit 规范</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#方案一：husky-commitlint">方案一：husky+commitlint</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#方案二：yorkie-verifycommits-js（实践发现并不能触发-githooks）">方案二：yorkie+verifyCommits.js（实践发现并不能触发 gitHooks）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#方案三：结合-husky-和自定义-verifycommits-js">方案三：结合 husky 和自定义 verifyCommits.js</a><!----></li></ul></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><p><code>代码规范</code> 是 <code>前端工程化</code> 落地的基石，用于约束 <code>编码规范</code> 和 <code>编码风格</code>，它的好处是：</p><ul><li>强制规范代码风格统一，保持一样的编码习惯</li><li>增加代码的可维护性和可接入性，即使有新成员的加入也能快速适应项目的架构与需求</li><li>保障项目的整体质量，可减少无用代码、重复代码、错误代码和 <code>BUG</code> 代码的产生几率</li></ul><p>我们通过配置代码校验工具（简称 <code>Lint</code>）来检测代码中的错误和漏洞，再根据其提供的修复方案格式化出正确代码。实现保存代码时一键校验，统一项目的编码规范和编码风格</p><h2 id="lint" tabindex="-1">Lint <a class="header-anchor" href="#lint" aria-hidden="true">#</a></h2><p><code>Lint</code> 其实就是编辑器中运行的一个 <code>脚本进程</code>，它会将代码解析为 <code>AST 抽象语法树</code> 🌲，再通过遍历语法树并通过预设规则去进行判断和改动，再将更新后的语法树转换为（尽量）规范化的代码</p><blockquote><p>待完善～</p></blockquote><h2 id="commit-规范" tabindex="-1">Commit 规范 <a class="header-anchor" href="#commit-规范" aria-hidden="true">#</a></h2><p>我们在使用 <code>Git</code> 托管代码时，规范化的 <code>Commit Message</code> 可以帮助大家直观清晰地理解每次修改的内容，不仅能帮助别人 <code>Review</code>，还可以有效地输出 <code>ChangeLog</code>。那么要想前端工程化项目更易于维护，最好有一套 <code>Git</code> 提交说明的 <code>规范化模板</code></p><p>目前最受开发人员肯定的规范是前端框架 <code>Angular</code> 提出的 <a href="https://zj-git-guide.readthedocs.io/zh_CN/latest/message/Angular%E6%8F%90%E4%BA%A4%E4%BF%A1%E6%81%AF%E8%A7%84%E8%8C%83/" target="_blank" rel="noopener noreferrer">Angular提交信息规范 🔗</a>，包含 <code>Header</code>（必填）、<code>Body</code> 和 <code>Footer</code> 三个部分的内容，提交格式如下：</p><div class="language-shell"><pre><code><span class="token operator">&lt;</span>type<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>scope<span class="token operator">&gt;</span><span class="token punctuation">)</span>: <span class="token operator">&lt;</span>subject<span class="token operator">&gt;</span>
<span class="token comment"># 空行</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token comment"># 空行</span>
<span class="token operator">&lt;</span>footer<span class="token operator">&gt;</span>
</code></pre></div><ol><li><p><code>Header</code> 作一行书写，包含 <code>type</code>，<code>scope</code>，<code>subject</code> 三个字段的内容</p><ul><li><p><code>type</code>：用于说明 commit 提交类型（必填）</p><ul><li><code>feat</code>：新增功能</li><li><code>fix</code>：Bug修复</li><li><code>docs</code>：文档更新</li><li><code>ci</code>：脚本更新，修改了 CI 配置文件或脚本</li><li><code>pref</code>：性能优化，提高性能的代码更改</li><li><code>build</code>：更新构建，构建系统或者外部依赖项进行了修改、更新</li><li><code>test</code>：新增测试，增加确实的测试或者矫正已存在的测试</li><li><code>refactor</code>：代码重构，非新增功能也非修复缺陷</li><li><code>chore</code>：事务变动，改动其他不影响代码的事务</li><li><code>revert</code>：代码回滚，撤销某次代码提交</li><li><code>merge</code>：分支合并，合并分支代码到其他分支</li><li><code>style</code>：格式变动，不影响代码逻辑</li><li><code>release</code>：版本发布</li></ul></li><li><p><code>scope</code>：用于说明 commit 的影响范围（选填）（比如按下面这些划分方案填写）</p><ul><li>按功能划分（如：数据层 - <code>Data</code>、视图层 - <code>View</code>和控制层 - <code>Control</code>）</li><li>按交互层划分（如：组件 - <code>Component</code>、布局 - <code>Layout</code>、流程 - <code>Flow</code>、视图 - <code>View</code>和页面 - <code>Page</code>）</li><li>按改动文件划分（如：某个文件 - <code>Button.tsx</code>，全部改动 -<code>*</code>）</li></ul></li><li><p><code>subject</code>：用于说明 commit 的细节描述（选填）。以精炼简洁的文字（中文还是英文就看各自规定了，一般推荐使用英文）说明提交的改动，比如可以遵循这些规则：</p><ul><li>以动词开头（如：<code>update</code>，<code>更新</code>）</li><li>使用第一人称现在时</li><li>首字母无需大写，重点区分的（如某组件）首字母无需大写</li><li>不以句号（<code>.</code> / <code>。</code>）结尾</li></ul></li></ul><p><code>commit</code> 信息示例：</p><div class="language-git"><pre><code>feat(Component): add Layout component
feat(Button.tsx): change the default size of the button
fix(EmitEvent): handle event on blur (closes #28)
</code></pre></div></li><li><p><code>Body</code> 部分可书写多行，对 <code>subject</code> 做更详尽的描述，内容应包括 <code>改动动机</code> 与 <code>改动前后对比</code></p></li><li><p><code>Footer</code> 部分只适用两种情况，分别是 <code>不兼容变动</code> 与 <code>问题关闭</code></p><ul><li><strong>不兼容变动</strong>：当前代码与上一版本不兼容，则以 <code>BREAKING CHANGE</code> 开头，关联变动描述、变动理由和迁移方法</li><li><strong>问题关闭</strong>：当前代码已修复某些 <code>Issue</code>，则以 <code>Closes</code> 开头，关联目标 <code>Issue</code></li></ul></li></ol><h3 id="方案一：husky-commitlint" tabindex="-1">方案一：<code>husky</code>+<code>commitlint</code> <a class="header-anchor" href="#方案一：husky-commitlint" aria-hidden="true">#</a></h3><ul><li><p>安装</p><div class="language-shell"><pre><code><span class="token function">pnpm</span> i husky @commitlint/cli @commitlint/config-conventional -D
</code></pre></div></li><li><p>初始化 <code>husky</code>，创建 <code>.husky</code> 文件夹</p><div class="language-shell"><pre><code>npx husky <span class="token function">install</span>
<span class="token comment"># 安装 git hooks，创建 .husky 目录</span>
<span class="token comment"># 结果：husky - Git hooks installed</span>

<span class="token comment"># 执行</span>
npx husky-init

<span class="token comment"># 它会在 package.json 文件的 scripts 字段中</span>
<span class="token comment"># 创建 &quot;prepare&quot;: &quot;husky install&quot; 命令</span>
<span class="token comment"># 同时在 .husky 目录下创建 pre-commit 文件</span>
<span class="token comment"># 结果：husky - created .husky/pre-commit</span>
</code></pre></div></li><li><p>在 <code>.husky</code> 目录下添加 <code>commit-msg</code> hook</p><div class="language-shell"><pre><code>npx husky <span class="token function">add</span> .husky/commit-msg <span class="token string">&#39;npx --no -- commitlint --edit &quot;$1&quot;&#39;</span>
</code></pre></div><div class="language-shell"><pre><code><span class="token comment"># 结果：husky - created .husky/commit-msg</span>
<span class="token comment"># .husky/commit-msg 文件内容：</span>

<span class="token comment">#!/usr/bin/env sh</span>
<span class="token builtin class-name">.</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> -- <span class="token string">&quot;<span class="token variable">$0</span>&quot;</span><span class="token variable">)</span></span>/_/husky.sh&quot;</span>

npx --no -- commitlint --edit <span class="token string">&quot;&quot;</span>
</code></pre></div></li><li><p>在 <code>package.json</code> 配置 <code>hooks</code></p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">/* commit 信息提交前会执行此 script，若未配置此命令，将会跳过 */</span>
      <span class="token property">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run test&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commitlint -e $HUSKY_GIT_PARAMS&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>创建 <code>commitlint.config.js</code> 文件夹</p><div class="language-js"><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@commitlint/config-conventional&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><p>至此，我们基本配好了 <code>git commit</code> 命令会执行默认的检测方案。当然，这里我并未深入测试更多：</p><div class="language-shell"><pre><code><span class="token function">git</span> commit -m <span class="token string">&quot;t&quot;</span>

<span class="token operator">&gt;</span> xxx@0.0.0 <span class="token builtin class-name">test</span>
<span class="token operator">&gt;</span> node index.js <span class="token comment"># 配置的 test 命令</span>

test<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span> <span class="token comment"># index.js 就一句: console.log(&#39;test......&#39;)</span>
⧗   input: t
✖   subject may not be empty <span class="token punctuation">[</span>subject-empty<span class="token punctuation">]</span>
✖   <span class="token builtin class-name">type</span> may not be empty <span class="token punctuation">[</span>type-empty<span class="token punctuation">]</span>

✖   found <span class="token number">2</span> problems, <span class="token number">0</span> warnings
ⓘ   Get help: https://github.com/conventional-changelog/commitlint/<span class="token comment">#what-is-commitlint</span>

husky - commit-msg hook exited with code <span class="token number">1</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span>
</code></pre></div><h3 id="方案二：yorkie-verifycommits-js（实践发现并不能触发-githooks）" tabindex="-1">方案二：<code>yorkie</code>+<code>verifyCommits.js</code>（实践发现并不能触发 gitHooks） <a class="header-anchor" href="#方案二：yorkie-verifycommits-js（实践发现并不能触发-githooks）" aria-hidden="true">#</a></h3><p>结合上面的代码规范 <code>Lint</code>，我们可以在 <code>pre-commit</code> hook 中进行代码格式化，<code>commit-msg</code> hook 我们可以执行我们自己定义的 js 文件去校验 <code>commit</code> 信息是否符合我们定义的 <code>commit 规范</code></p><ul><li><p>安装</p><div class="language-shell"><pre><code><span class="token function">pnpm</span> i yorkie lint-staged chalk eslint prettier @typescript-eslint/parser -D
</code></pre></div><ul><li><code>yorkie</code>：<code>EvanYou</code> fork <code>husky</code> 的一个 <code>npm</code> 包（不兼容 <code>husky</code>）</li><li><code>lint-staged</code>：它仅是一个文件过滤器，这里的 staged 是与 Git 中的概念一致的，过滤出 <code>Git</code> 代码暂存区的代码（<code>committed</code> 的代码）</li><li><code>chalk</code>：一个多彩的 <code>log</code> 记录工具</li><li><code>eslint</code>，<code>prettier</code>：上面的 <code>Lint</code> 工具</li><li><code>@typescript-eslint/parser</code>：用于解析格式化 <code>typescript</code> 代码</li></ul></li><li><p>配置 <code>hooks</code> （<code>package.json</code>）</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;gitHooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 触发格式化 */</span>
    <span class="token property">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lint-staged&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">/* 我们自定义的校验 commit 信息的 js 文件 */</span>
    <span class="token property">&quot;commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node scripts/verifyCommit.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;*.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;prettier --write&quot;</span> <span class="token comment">/* 结合 .prettierrc 文件声明格式 */</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;*.ts?(x)&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;eslint&quot;</span><span class="token punctuation">,</span> <span class="token comment">/* 结合 .eslintrc.js 文件声明格式 */</span>
      <span class="token string">&quot;prettier --parser=typescript --write&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p><strong><code>verifyCommits.js</code></strong></p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> bgRed<span class="token punctuation">,</span> red<span class="token punctuation">,</span> green <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;chalk&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> msgPath <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GIT_PARAMS</span>
<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>msgPath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/* commit 信息规则， */</span>
<span class="token keyword">const</span> commitRE <span class="token operator">=</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(revert: )?(feat|fix|docs|dx|style|refactor|perf|test|workflow|build|ci|chore|types|wip|release)(\(.+\))?: .{1,50}</span><span class="token regex-delimiter">/</span></span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>commitRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bgRed<span class="token punctuation">.</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token string">&#39; ERROR &#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">red</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">invalid commit message format.</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token function">red</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  Proper commit message format is required for automated changelog generation. Examples:\n\n</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">feat(compiler): add &#39;comments&#39; option</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">green</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">fix(Input.tsx): handle events on blur (close #28)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token function">red</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  See .github/commit-convention.md for more details.\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><p>至此，已经完成 yorkie 配置，但实际测试提交 commit 时，并不能触发 <code>pre-commit</code> 和 <code>commit-msg</code> hook，可能是我哪里使用的姿势不对吧！（故放弃）</p><h3 id="方案三：结合-husky-和自定义-verifycommits-js" tabindex="-1">方案三：结合 husky 和自定义 verifyCommits.js <a class="header-anchor" href="#方案三：结合-husky-和自定义-verifycommits-js" aria-hidden="true">#</a></h3><ul><li><p>安装</p><div class="language-shell"><pre><code><span class="token function">pnpm</span> i husky lint-staged eslint prettier chalk -D
<span class="token comment"># 太长，分两行书写，下面的是对 ts 文件格式化的插件</span>
<span class="token function">pnpm</span> i @typescript-eslint/parser @typescript-eslint/eslint-plugin -D
</code></pre></div><div class="language-shell"><pre><code>npx husky <span class="token function">install</span> <span class="token comment"># 安装 .husky 目录</span>
npx husky-init <span class="token comment"># 创建 pre-commit hook</span>
</code></pre></div></li><li><p>修改 <code>.husky/pre-commit</code> 文件：</p><div class="language-sh"><pre><code>#!/usr/bin/env sh
. &quot;$(dirname -- &quot;$0&quot;)/_/husky.sh&quot;

# npm test  # 这句删掉，改为下面这行，进行代码格式化检测
npx lint-staged
</code></pre></div></li><li><p>添加 <code>commit-msg</code> hook</p><div class="language-sh"><pre><code># scripts/verifyCommits.js 即为我们自定义的校验文件
npx husky add .husky/commit-msg &#39;node scripts/verifyCommits.js &quot;$1&quot;&#39;
</code></pre></div><p><strong>⚠️：</strong> <strong><code>$1</code></strong> 必须在 <code>.husky/commit-msg</code> 文件中写上（在我们使用 <code>git commit -m &quot;[msg]&quot;</code> 时，会传递给 <code>$1</code> 参数），否则我们执行自定义校验 commit 文件时是无法拿到 commit 信息的，文件内容如下：</p><div class="language-sh"><pre><code>#!/usr/bin/env sh
. &quot;$(dirname -- &quot;$0&quot;)/_/husky.sh&quot;

node scripts/verifyCommits.js &quot;$1&quot;
</code></pre></div></li><li><p>创建 <code>scripts/verifyCommits.js</code> 文件：</p><div class="language-js"><pre><code><span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;chalk&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// const msgPath = process.<wbr>env.GIT_PARAMS // 此为 undefined 拿不到 msg 信息</span>
<span class="token keyword">const</span> msgPath <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>msgPath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span>bgBlueBright<span class="token punctuation">.</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token string">&#39;Commit Msg: &#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>

<span class="token keyword">const</span> commitRE <span class="token operator">=</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(revert: )?(feat|fix|docs|dx|style|refactor|perf|test|workflow|build|ci|chore|types|wip|release)(\(.+\))?: .{1,50}</span><span class="token regex-delimiter">/</span></span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>commitRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span>bgRed<span class="token punctuation">.</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token string">&#39; ERROR &#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">invalid commit message format.</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  Proper commit message format is required for automated changelog generation. Examples:\n\n</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">feat(compiler): add &#39;comments&#39; option</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">fix(input): handle events on blur (close #28)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  See .github/commit-convention.md for more details.\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>配置 <code>package.json</code> 文件内容（实际上这里配不配都不影响，实际执行的依旧是 <code>.husky</code> 目录下的 hook 文件，为了在 <code>package.json</code> 文件中直观展示，我们将其同步）</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token comment">/* husky hooks 不配也不影响 */</span>
  <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">/* commit 信息提交前会执行此 script，若未配置此命令，将会跳过 */</span>
      <span class="token property">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lint-staged&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node scripts/verifyCommits.js&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* lint-staged 必须配置 */</span>
  <span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;*.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;prettier --write&quot;</span> <span class="token comment">/* 结合 .prettierrc 文件声明格式 */</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;*.ts?(x)&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;eslint&quot;</span><span class="token punctuation">,</span> <span class="token comment">/* 结合 .eslintrc.js 文件声明格式 */</span>
      <span class="token string">&quot;prettier --parser=typescript --write&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>创建 <code>.eslintrc.js</code> 文件和 <code>.pretterrc</code> 文件中写上</p><div class="language-js"><pre><code><span class="token comment">// .eslintrc.js 文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  env<span class="token operator">:</span> <span class="token punctuation">{</span>
    browser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    es2021<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;eslint:recommended&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;plugin:@typescript-eslint/recommended&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  parser<span class="token operator">:</span> <span class="token string">&#39;@typescript-eslint/parser&#39;</span><span class="token punctuation">,</span>
  parserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    ecmaVersion<span class="token operator">:</span> <span class="token string">&#39;latest&#39;</span><span class="token punctuation">,</span>
    sourceType<span class="token operator">:</span> <span class="token string">&#39;module&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@typescript-eslint&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  rules<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// .pretterrc 文件</span>
semi<span class="token operator">:</span> <span class="token boolean">false</span>
singleQuote<span class="token operator">:</span> <span class="token boolean">true</span>
printWidth<span class="token operator">:</span> <span class="token number">80</span>
trailingComma<span class="token operator">:</span> <span class="token string">&#39;none&#39;</span>
arrowParens<span class="token operator">:</span> <span class="token string">&#39;avoid&#39;</span>
</code></pre></div></li></ul><p>配置完毕，我们试试吧</p><div class="language-shell"><pre><code>➡️ <span class="token function">git</span> commit -m <span class="token string">&quot;tes: 错误示例 🙅&lt;200d&gt;♂️&quot;</span>

✔ Preparing lint-staged<span class="token punctuation">..</span>.
✔ Running tasks <span class="token keyword">for</span> staged files<span class="token punctuation">..</span>.
✔ Applying modifications from tasks<span class="token punctuation">..</span>.
✔ Cleaning up temporary files<span class="token punctuation">..</span>.

Commit Msg:  tes: 错误示例 🙅‍♂️

   ERROR  invalid commit message format.

  Proper commit message <span class="token function">format</span> is required <span class="token keyword">for</span> automated changelog generation. Examples:

    feat<span class="token punctuation">(</span>compiler<span class="token punctuation">)</span>: <span class="token function">add</span> <span class="token string">&#39;comments&#39;</span> option
    fix<span class="token punctuation">(</span>input<span class="token punctuation">)</span>: handle events on blur <span class="token punctuation">(</span>close <span class="token comment">#28)</span>

  See .github/commit-convention.md <span class="token keyword">for</span> <span class="token function">more</span> details.

husky - commit-msg hook exited with code <span class="token number">1</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span>
</code></pre></div><p>当然，整体来说也只是一个推荐性的规范方案，<code>commit</code> 同样可以通过 <code>-n</code> 或者是 <code>-no-verify</code> 直接绕开 <code>commit</code> 检测</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/suressk/edit/deploy/docs/knowledge/engineering/lint.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Edit this page on GitHub <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>Last Updated:</span><span class="datetime" data-v-5797b537></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/knowledge/engineering/compare" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>打包工具对比</span></a></div><div class="next" data-v-38ede35f><!----></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"algorithm_index.md\":\"07455bd8\",\"algorithm_summary_complexity.md\":\"e4314726\",\"algorithm_summary_merge.md\":\"a507b0d1\",\"algorithm_summary_stack.md\":\"8fd5ef65\",\"index.md\":\"3d5aec8a\",\"interview_index.md\":\"c153c384\",\"interview_summary_actual.md\":\"a1779721\",\"interview_summary_basis.md\":\"27c2b06e\",\"interview_summary_index.md\":\"d781eb41\",\"interview_summary_internet.md\":\"a2564cc0\",\"interview_summary_optimization.md\":\"0ac8276c\",\"interview_summary_strands.md\":\"3ba97aa1\",\"knowledge_engineering_compare.md\":\"063d6596\",\"knowledge_engineering_hotupdate.md\":\"1bb6f4e3\",\"knowledge_engineering_lint.md\":\"19fb12b1\",\"knowledge_engineering_loaderandplugin.md\":\"eaa60404\",\"knowledge_engineering_tapable.md\":\"2e488879\",\"knowledge_engineering_webpack.md\":\"ae3d15f0\",\"knowledge_index.md\":\"52114bbe\",\"knowledge_react_fiber.md\":\"4c59546e\",\"knowledge_react_index.md\":\"8c7e7774\",\"knowledge_study_algorithm.md\":\"dab2c708\",\"knowledge_study_jseventloop.md\":\"4b6487b1\",\"knowledge_study_promise.md\":\"0e207524\",\"knowledge_study_vuenexttick.md\":\"995fc51a\",\"knowledge_vite_esbuild.md\":\"b8f6e42d\",\"knowledge_vite_index.md\":\"8b37f38e\",\"knowledge_vite_plugin.md\":\"052e8900\",\"knowledge_vite_resolveconfig.md\":\"3a3c4bd6\",\"knowledge_vite_vitejs.md\":\"e2a412f7\",\"mood_autumn.md\":\"451c0477\",\"mood_chinaintheclassics.md\":\"4856dd65\",\"mood_dragonboatfestival.md\":\"b123aaa5\",\"mood_fate.md\":\"fe10bc78\",\"mood_feels.md\":\"ca7dc171\",\"mood_index.md\":\"29226340\",\"mood_loneliness.md\":\"032d272e\",\"mood_spring.md\":\"182d4c2d\",\"mood_wind.md\":\"069112ed\",\"mood_yearend.md\":\"4607e7ea\"}")</script>
    <script type="module" async src="/assets/app.108cc30f.js"></script>
    
  </body>
</html>