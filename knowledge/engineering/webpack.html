<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | K.island ✨</title>
    <meta name="description" content="K.'s island">
    <link rel="stylesheet" href="/assets/style.019f39fc.css">
    <link rel="modulepreload" href="/assets/Home.7f051d33.js">
    <link rel="modulepreload" href="/assets/app.108cc30f.js">
    <link rel="modulepreload" href="/assets/knowledge_engineering_webpack.md.ae3d15f0.lean.js">
    <link rel="modulepreload" href="/assets/app.108cc30f.js">
    <link rel="icon" href="/favicon.ico" sizes="64x64">
    <link rel="apple-touch-icon-precomposed" href="/favicon.ico" sizes="64x64">
    <link rel="msapplication-square64x64logo" href="/favicon.ico" sizes="64x64">
    <meta name="twitter:title" content="webpack | K.island ✨">
    <meta property="og:title" content="webpack | K.island ✨">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="K.island ✨, back to home" data-v-675d8756 data-v-4a583abe><!----> K.island ✨</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Home <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/mood/index" data-v-b8818f8c>Mood <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/knowledge/index" data-v-b8818f8c>Knowledge <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/interview/index" data-v-b8818f8c>Interview <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/algorithm/index" data-v-b8818f8c>Algorithm <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/suressk" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Home <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/mood/index" data-v-b8818f8c>Mood <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/knowledge/index" data-v-b8818f8c>Knowledge <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/interview/index" data-v-b8818f8c>Interview <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/algorithm/index" data-v-b8818f8c>Algorithm <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/suressk" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">Introduction</p><!----></li><li class="sidebar-link"><p class="sidebar-link-item">Study Note</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/jsEventLoop">JS EventLoop</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/promise">Promise</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/vueNextTick">Vue NextTick</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/study/algorithm">Algorithm</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Vite</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/index">Vite 原理简介</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/vitejs">从 vite 到 createServer</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/resolveConfig">resolveConfig</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/esbuild">依赖预构建</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/vite/plugin">插件机制</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">React</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/react/index">React 笔记文章 - 掘金</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/react/fiber">React Fiber</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Engineering</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/knowledge/engineering/webpack">webpack</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#模块化的探索阶段">模块化的探索阶段</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#在开发阶段我们会遇到的问题-想要的方式">在开发阶段我们会遇到的问题/想要的方式</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#webpack-是什么">webpack 是什么</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#webpack-的能力">webpack 的能力</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#webpack-的构建流程">webpack 的构建流程</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#初始化流程">初始化流程</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#编译构建流程">编译构建流程</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#输出流程">输出流程</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#"></a><!----></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/loaderAndPlugin">webpack Loader &amp; plugin</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/tapable">webpack Tapable</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/hotUpdate">webpack 热更新</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/compare">打包工具对比</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/knowledge/engineering/lint">代码规范</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><p><code>Webpack</code> 最初的目标是实现前端项目的模块化，旨在更高效地管理和维护项目中的每一个资源</p><h2 id="模块化的探索阶段" tabindex="-1">模块化的探索阶段 <a class="header-anchor" href="#模块化的探索阶段" aria-hidden="true">#</a></h2><ol><li>通过 <code>文件划分模块</code> 的方案，将每个功能及其相关状态数据各自单独放到不同的 JS 文件中，约定每个文件是一个单独的模块，最后通过 <code>&lt;script&gt;</code> 标签引入页面（<code>存在的问题</code>：模块全部挂载在全局对象上，大量模块成员污染了环境，可以随意修改模块内部内容，模块与模块之间并没有依赖关系、维护困难、没有私有空间等）</li><li>出现 <code>命名空间</code>，规定每个模块只暴露一个全局对象，模块的内容都挂载到这个对象上（同样存在可以随意修改，模块依赖关系不明等问题）</li><li>通过 <code>立即执行函数</code> 为模块提供私有空间，通过参数的形式作为依赖声明（明显看来上面罗列的问题都被此方案解决了）</li></ol><p>但还存在其他的问题：我们是通过 <code>&lt;script&gt;</code> 标签在页面引入这些模块的，这些模块的加载并不受代码的控制（一次性全加载），时间一久维护起来也十分的麻烦</p><blockquote><p>理想的解决方式是：在页面中引入一个 JS 入口文件，其余用到的模块可以通过代码控制，按需加载进来</p></blockquote><h2 id="在开发阶段我们会遇到的问题-想要的方式" tabindex="-1">在开发阶段我们会遇到的问题/想要的方式 <a class="header-anchor" href="#在开发阶段我们会遇到的问题-想要的方式" aria-hidden="true">#</a></h2><ol><li>通过模块化的方式开发</li><li>通过一些高级特性来加快我们的开发效率或者安全性，如：<code>ES6+</code> 语法，<code>TypeScript</code> 开发脚本逻辑，<code>sass</code>、<code>less</code> 编写样式等</li><li>监听文件的变化来并且实时热更新反映到浏览器上，提升开发效率</li><li>js 代码需要模块化，同样还有其他类型的文件，如 css，图片等资源</li><li>开发完成后需要将代码进行压缩、合并以及其他相关的优化</li></ol><p><code>webpack</code> 的出现恰好可以解决这些问题</p><h2 id="webpack-是什么" tabindex="-1">webpack 是什么 <a class="header-anchor" href="#webpack-是什么" aria-hidden="true">#</a></h2><p><code>webpack</code> 是一个用于现代 <code>JavaScript</code> 应用程序的 <strong>静态模块</strong> 打包工具</p><p>静态模块：指的是开发阶段，可以被 <code>webpack</code> 直接引用的资源（可以直接被获取打包进 <code>bundle.js</code> 的资源）</p><p>当 <code>webpack</code> 处理应用程序时，它会在内部构建一个依赖图，此依赖图对应映射到项目所需的每个模块（不再局限 <code>js文件</code>），并生成一个或多个 <code>bundle</code></p><p><code>webpack</code> 功能示意图：</p><p><img src="https://static.vue-js.com/9ce194a0-a578-11eb-85f6-6fac77c0c9b3.png" alt="webpack功能示意图"></p><h2 id="webpack-的能力" tabindex="-1">webpack 的能力 <a class="header-anchor" href="#webpack-的能力" aria-hidden="true">#</a></h2><ol><li><strong><code>代码编译能力</code></strong>，提高效率，解决浏览器兼容问题（将开发阶段的 ES6+ 语法、TypeScript 脚本编译为 ES5 低版本代码）</li><li><strong><code>模块整合能力</code></strong>，提高性能，可维护性，解决浏览器频繁请求文件的问题（将多个模块文件打包成一个 bundle）</li><li><strong><code>万物皆可模块化</code></strong>，项目维护性增强，支持不同种类的前端模块类型，统一的模块化方案，所有资源文件的加载都可以通过代码控制（<code>.ts</code>、<code>.js</code>、<code>.png</code>、<code>.scss</code> 文件等)</li></ol><h2 id="webpack-的构建流程" tabindex="-1">webpack 的构建流程 <a class="header-anchor" href="#webpack-的构建流程" aria-hidden="true">#</a></h2><p><code>webpack</code> 的运行流程是一个串行的过程，它的工作流程就是将各个插件串联起来；在运行过程中会 <code>广播事件</code>，插件只需要监听它所关心的事件，就能加入到这条 <code>webpack</code> 机制中，去改变 <code>webpack</code> 的运作，使得整个系统扩展性良好</p><p>从启动到结束会依次执行以下三大步骤：</p><ol><li><code>初始化流程</code>：从配置文件和 Shell 语句中读取与合并参数，并初始化需要使用的插件和配置插件等执行环境所需要的参数</li><li><code>编译构建流程</code>：从 <code>Entry</code> 出发，针对每个 <code>Module</code> 串行调用对应的 <code>Loader</code> 去翻译文件内容，再找到该 <code>Module</code> 依赖的 <code>Module</code>，递归地进行编译处理</li><li><code>输出流程</code>：对编译后的 <code>Module</code> 组合成 <code>Chunk</code>，把 <code>Chunk</code> 转换成文件，输出到文件系统</li></ol><h3 id="初始化流程" tabindex="-1">初始化流程 <a class="header-anchor" href="#初始化流程" aria-hidden="true">#</a></h3><p>从配置文件（<code>webpack.config.js</code>，或者通过命令的形式指定配置文件）和 <code>shell</code> 命令（或是 <code>scripts</code> 配置的命令）中读取并合并参数，得到最终参数。主要作用是用于激活 <code>webpack</code> 的加载项（loader）和插件（plugin）</p><div class="language-js"><pre><code><span class="token comment">// webpack.config.js 示例配置如下</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> HotModuleReplacementPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">resolvePath</span> <span class="token operator">=</span> <span class="token parameter">pathStr</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> pathStr<span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span>
    <span class="token comment">// 入口文件，是模块构建的起点，一个入口文件对应最后生成的一个 chunk</span>
    entry<span class="token operator">:</span> <span class="token string">&#39;./src/main.ts&#39;</span><span class="token punctuation">,</span>
    <span class="token comment">// entry: {}, // 多入口可配为 数组/对象 格式</span>
    <span class="token comment">// 模块文件别名</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        alias<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&#39;@&#39;</span><span class="token operator">:</span> <span class="token function">resolvePath</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&#39;@comp&#39;</span><span class="token operator">:</span> <span class="token function">resolvePath</span><span class="token punctuation">(</span><span class="token string">&#39;src/components&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 生成文件，是模块构建的终点，包括输出文件与输出路径</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token function">resolvePath</span><span class="token punctuation">(</span><span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">&#39;foo.bundle.js&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 配置 loader</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;less-loader&#39;</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置 plugin</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p><code>webpack</code> 将 <code>webpack.config.js</code> 中的配置项拷贝到 <code>options</code> 对象中，并加载用户配置的 <code>plugins</code></p></li><li><p>之后，开始初始化 <code>Compiler</code> 编译对象，该对象掌控着 <code>webpack</code> 生命周期，定义了很多钩子函数，不执行具体的任务，只是进行一些调度工作</p><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            initialize<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 来自 tapable</span>
            shouldEmit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncBailHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            done<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;stats&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            afterDone<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;stats&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            additionalPass<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            beforeRun<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compiler&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            run<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compiler&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            emit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            assetEmitted<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            afterEmit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// ... 定义很多类型的 钩子函数</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">webpack</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 根据 Array.isArray(options) 区分</span>
        <span class="token comment">// new MultiCompiler(compilers, options)</span>

        <span class="token comment">// new Compiler()</span>
        <span class="token comment">// 得到如下 compiler 对象，watch 监听开关（boolean），watchOptions</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> compiler<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> watchOptions <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 有 callback 函数，则开启监听</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> compiler<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> watchOptions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>watch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>watchOptions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                compiler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token parameter">err2</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">callback</span><span class="token punctuation">(</span>err <span class="token operator">||</span> err2<span class="token punctuation">,</span> stats<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> compiler <span class="token comment">// 返回 compiler 对象</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> compiler<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> compiler
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><h3 id="编译构建流程" tabindex="-1">编译构建流程 <a class="header-anchor" href="#编译构建流程" aria-hidden="true">#</a></h3><ul><li><p>根据配置中的 <code>entry</code> 找出所有的入口文件</p></li><li><p>初始化完成后，调用 <code>compiler.watch</code> / <code>compiler.run</code> 来启动编译构建流程，主要流程为：</p><ul><li><code>compile</code> 开始编译</li><li><code>make</code> 从入口点分析模块及其依赖的模块，创建这些模块对象</li><li><code>build-module</code> 构建模块</li><li><code>seal</code> 封装构建结果</li><li><code>emit</code> 把各个chunk输出到结果文件</li></ul></li><li><p><code>compile</code> 编译</p><blockquote><p>主要是构建一个 <code>Compilation</code> 对象，它是编译阶段的主要执行者，主要会依次进行 <code>执行模块创建</code>、<code>依赖收集</code>、<code>分块</code>、<code>打包</code> 等主要任务的对象</p></blockquote></li><li><p><code>make</code> 编译模块</p><blockquote><p>得到 <code>Compilation</code> 对象后，就开始从 <code>entry</code> 入口文件开始读取，主要执行 <code>addModuleChain</code>，执行 <code>buildModule</code> 进入真正的构建模块 <code>module</code> 内容的过程</p></blockquote></li><li><p><code>build-module</code> 完成模块编译</p><blockquote><p>主要调用配置的 <code>loaders</code>，将我们的模块转成标准的 <code>JS模块</code>，在用Loader 对一个模块转换完后，使用 <code>acorn</code> 解析转换后的内容，输出对应的抽象语法树（<code>AST</code>），以方便 <code>Webpack</code> 后面对代码的分析；从配置的入口模块开始，分析其 <code>AST</code>，当遇到 <code>require</code> 等导入其它模块语句时，便将其加入到依赖的模块列表，同时对新找出的依赖模块递归分析，最终搞清 <code>所有模块的依赖关系</code></p></blockquote></li></ul><h3 id="输出流程" tabindex="-1">输出流程 <a class="header-anchor" href="#输出流程" aria-hidden="true">#</a></h3><ul><li><p><code>seal</code> 输出资源</p><blockquote><p>主要是要生成chunks，对chunks进行一系列的优化操作，并生成要输出的代码；<code>webpack</code> 会根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 Chunk，再把每个 Chunk 转换成一个单独的文件加入到输出列表</p></blockquote></li><li><p><code>emit</code> 输出完成</p><blockquote><p>根据 <code>webpack.config.js</code> <code>output</code> 配置确定输出的路径和文件名；在 <code>Compiler</code> 开始生成文件前，钩子 <code>emit</code> 会被执行，这是我们修改最终文件的 <code>最后一个机会</code></p></blockquote></li></ul><p>示意图如下：</p><p><img src="https://static.vue-js.com/d77fc560-a658-11eb-85f6-6fac77c0c9b3.png" alt="打包流程示意图"></p><h3 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h3></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/suressk/edit/deploy/docs/knowledge/engineering/webpack.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Edit this page on GitHub <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>Last Updated:</span><span class="datetime" data-v-5797b537></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/knowledge/react/fiber" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>React Fiber</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/knowledge/engineering/loaderAndPlugin" data-v-38ede35f><span class="text" data-v-38ede35f>webpack Loader &amp; plugin</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"algorithm_index.md\":\"07455bd8\",\"algorithm_summary_complexity.md\":\"e4314726\",\"algorithm_summary_merge.md\":\"a507b0d1\",\"algorithm_summary_stack.md\":\"8fd5ef65\",\"index.md\":\"3d5aec8a\",\"interview_index.md\":\"c153c384\",\"interview_summary_actual.md\":\"a1779721\",\"interview_summary_basis.md\":\"27c2b06e\",\"interview_summary_index.md\":\"d781eb41\",\"interview_summary_internet.md\":\"a2564cc0\",\"interview_summary_optimization.md\":\"0ac8276c\",\"interview_summary_strands.md\":\"3ba97aa1\",\"knowledge_engineering_compare.md\":\"063d6596\",\"knowledge_engineering_hotupdate.md\":\"1bb6f4e3\",\"knowledge_engineering_lint.md\":\"19fb12b1\",\"knowledge_engineering_loaderandplugin.md\":\"eaa60404\",\"knowledge_engineering_tapable.md\":\"2e488879\",\"knowledge_engineering_webpack.md\":\"ae3d15f0\",\"knowledge_index.md\":\"52114bbe\",\"knowledge_react_fiber.md\":\"4c59546e\",\"knowledge_react_index.md\":\"8c7e7774\",\"knowledge_study_algorithm.md\":\"dab2c708\",\"knowledge_study_jseventloop.md\":\"4b6487b1\",\"knowledge_study_promise.md\":\"0e207524\",\"knowledge_study_vuenexttick.md\":\"995fc51a\",\"knowledge_vite_esbuild.md\":\"b8f6e42d\",\"knowledge_vite_index.md\":\"8b37f38e\",\"knowledge_vite_plugin.md\":\"052e8900\",\"knowledge_vite_resolveconfig.md\":\"3a3c4bd6\",\"knowledge_vite_vitejs.md\":\"e2a412f7\",\"mood_autumn.md\":\"451c0477\",\"mood_chinaintheclassics.md\":\"4856dd65\",\"mood_dragonboatfestival.md\":\"b123aaa5\",\"mood_fate.md\":\"fe10bc78\",\"mood_feels.md\":\"ca7dc171\",\"mood_index.md\":\"29226340\",\"mood_loneliness.md\":\"032d272e\",\"mood_spring.md\":\"182d4c2d\",\"mood_wind.md\":\"069112ed\",\"mood_yearend.md\":\"4607e7ea\"}")</script>
    <script type="module" async src="/assets/app.108cc30f.js"></script>
    
  </body>
</html>